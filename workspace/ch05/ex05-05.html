<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List</title>
  </head>
  <body>
    <div id="todo">
      <header>
        <h1>Todo List - ëª©ë¡ ì¡°íšŒ ğŸ™‚</h1>
      </header>
      <div id="main">
        <div id="container">
          <ul>
            <li>
              <h2>ì‡¼í•‘ ëª©ë¡</h2>
              <div class="todoinput">
                <input type="text" autofocus onkeyup="handleKeyup(event)" />
                <button type="button" onclick="handleAdd()">ì¶”ê°€</button>
              </div>
              <ul class="todolist">
                <!-- <li data-no="1">
                  <span>1</span>
                  <span><s>ìƒ˜í”Œ1</s></span>
                  <button type="button">ì‚­ì œ</button>
                </li>
                <li data-no="2">
                  <span>2</span>
                  <span>ìƒ˜í”Œ2</span>
                  <button type="button">ì‚­ì œ</button>
                </li>
                <li data-no="3">
                  <span>3</span>
                  <span>ìƒ˜í”Œ3</span>
                  <button type="button">ì‚­ì œ</button>
                </li> -->
              </ul>
            </li>
          </ul>
        </div>
      </div>
      <footer>
        <p>ë©‹ìŸì´ ì‚¬ìì²˜ëŸ¼ FrontEnd BootCamp</p>
      </footer>
    </div>
    <script>
      // í•œê±´ì˜ Todo ê°ì²´ë¥¼ ë°›ì•„ì„œ Dom ê°ì²´ë¡œ ë§Œë“¤ì–´ ë°˜í™˜í•˜ëŠ” ê¸°ëŠ¥
      function getTodoItemElem(item) {
        //{no : 3, title:'ë¼ë©´', done :true} // todoê°ì²´
        /* ë°˜í™˜í•  Domê°ì²´
        <li>
          <span>3</span>
          <span>ìƒ˜í”Œ3</span>
          <button type="button">ì‚­ì œ</button>
        </li>
        */

        // <li> ìš”ì†Œ ìƒì„± (í•  ì¼ í•˜ë‚˜ì˜ ì „ì²´ ë¬¶ìŒ)
        const liElem = document.createElement("li");

        // ë²ˆí˜¸ í‘œì‹œìš© <span> ìš”ì†Œ ìƒì„±
        const noElem = document.createElement("span");

        // í•  ì¼ ì œëª© í‘œì‹œìš© <span> ìš”ì†Œ ìƒì„±
        const titleElem = document.createElement("span");

        // ì‚­ì œ ë²„íŠ¼ <button> ìš”ì†Œ ìƒì„±
        const deletElem = document.createElement("button");

        // ê°ê°ì— ë“¤ì–´ê°ˆ í…ìŠ¤íŠ¸ ë…¸ë“œ ìƒì„±
        const noTxt = document.createTextNode(item.no); // ë²ˆí˜¸ í…ìŠ¤íŠ¸
        const titleTxt = document.createTextNode(item.title); // í•  ì¼ ì œëª© í…ìŠ¤íŠ¸
        const deletTxt = document.createTextNode("ì‚­ì œ"); // ë²„íŠ¼ í…ìŠ¤íŠ¸

        // í…ìŠ¤íŠ¸ ë…¸ë“œë¥¼ í•´ë‹¹ ìš”ì†Œì— ë¶™ì´ê¸°
        noElem.appendChild(noTxt); // ë²ˆí˜¸ â†’ <span>
        titleElem.appendChild(titleTxt); // ì œëª© â†’ <span>
        deletElem.setAttribute("type", "button"); // ë²„íŠ¼ íƒ€ì… ëª…ì‹œ
        titleElem.setAttribute("tabindex", 0); // ì™„ë£Œ/ë¯¸ì™„ë£Œì²˜ë¦¬ë¥¼ ìœ„í•œ íƒ­í¬ì»¤ì‹±
        deletElem.appendChild(deletTxt); // "ì‚­ì œ" â†’ <button>

        liElem.appendChild(noElem);
        liElem.appendChild(titleElem);
        liElem.appendChild(deletElem);

        // ì»¤ìŠ¤í…€ ì†ì„± ì¶”ê°€
        liElem.dataset.no = item.no;
        liElem.dataset.done = item.done;

        // ì‚­ì œ ì´ë²¤íŠ¸
        deletElem.setAttribute("onclick", `deletItem(${item.no})`);

        // ì™„ë£Œë¯¸ì™„ë£Œ ì°¨ì´
        // titleElem.setAttribute("onclick", `toggleDone(${item.no})`);

        deletElem.addEventListener("click", function (event) {
          // const btn = event.target;
          // const liNode = btn.closest("li");
          // deletItem(liNode.dataset.no);
        });

        titleElem.addEventListener("click", function (event) {
          const btn = event.target;
          const liNode = btn.closest("li");
          toggleDone(liNode.dataset.no);
        });

        return liElem;
      }

      // ì¶”ê°€ ë²„íŠ¼ í´ë¦­ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
      function handleAdd() {
        const inputElem = document.querySelector(".todoinput > input");
        if (inputElem.value.trim() !== "") {
          addItem(inputElem.value.trim()); // ë¹ˆê³µë°±ì´ ì•„ë‹ë•Œë§Œ addItem í•¨ìˆ˜ ì‹¤í–‰
          inputElem.value = ""; // input ê°’ ì´ˆê¸°í™”
          inputElem.focus(); // ì¶”ê°€ ë²„íŠ¼ í´ë¦­ì´í›„ í¬ì»¤ìŠ¤ì´ë™
        }
      }

      //ì—”í„° í‚¤ë¥¼ ëˆŒë €ì„ë•Œ ì²˜ë¦¬í•  ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
      function handleKeyup(event) {
        // í‚¤ë³´ë“œ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” event ê°ì²´
        if (event.key === "Enter") {
          handleAdd();
        }
      }

      //í• ì¼ì¶”ê°€
      function addItem(title) {
        const todoList = document.querySelector(".todolist");

        const item = {
          no: todoList.children.length + 1,
          // title: title, //ì†ì„±ê°’ì„ ë‹´ëŠ” ë³€ìˆ˜ê°€ ì†ì„±ëª…ê³¼ ì¼ì¹˜ í•  ê²½ìš°, ì†ì„±ê°’ ìƒëµ ê°€ëŠ¥í•˜ë‹¤.
          title,
          done: false,
        };
        const todoLi = getTodoItemElem(item);
        console.log(todoLi);
        todoList.appendChild(todoLi);
      }

      // ì™„ë£Œ/ë¯¸ì™„ë£Œ ì²˜ë¦¬ ë‚´ê°€ í˜¼ìí•œë²„ì „
      /*
      function toggleDone(no) {
        const targetli = document.querySelector(
          `.todolist > li[data-no="${no}"]`
        );
        const targetSpan = targetli.childNodes[1];
        const defaultText = targetSpan.textContent;
        const targetDone = targetli.dataset.done;
        const creatText = document.createTextNode(defaultText);
        const sElem = document.createElement("s");

        console.log(targetDone);
        if (targetDone == "false") {
          targetli.dataset.done = "true";
          targetSpan.textContent = "";
          sElem.appendChild(creatText);
          targetSpan.appendChild(sElem);
        } else {
          console.log("ë¶ˆí†µ");
          targetli.dataset.done = "false";
          targetSpan.textContent = "";
          targetSpan.appendChild(creatText);
        }
      }
        */

      // ìˆ˜ì—…ë²„ì „
      function toggleDone(no) {
        const targetli = document.querySelector(
          `.todolist > li[data-no="${no}"]`
        );
        const done = targetli.dataset.done === "true";
        const titleEl = targetli.querySelector("span:last-of-type");
        const text = titleEl.textContent;
        if (done) {
          // doneì´ ì°¸ì¼ë•Œ -> ì·¨ì†Œì„  ë¹¼~ê¸°
          console.log("ì°¸ì…ë‹ˆë‹¤");
          // titleEl.firstChild.remove();
          titleEl.textContent = text;
          // titleEl.appendChild(text);
        } else {
          // doneì´ ê±°ì§“ì¼ë•Œ -> ì·¨ì†Œì„ ë„£ê¸°
          console.log("ê·¸~ì§“ ì…ë‹ˆë‹¤");
          const sEl = document.createElement("s");
          sEl.appendChild(titleEl.firstChild);
          titleEl.appendChild(sEl);
        }
        targetli.dataset.done = !done;
      }

      // í• ì¼ ì‚­ì œ
      function deletItem(no) {
        const targetli = document.querySelector(
          `.todolist > li[data-no="${no}"]`
        );
        targetli.remove();
      }
    </script>
  </body>
</html>
